import { Observable } from "rxjs/internal/Observable";
import { MESSAGE } from "../../config";
import { allEvents, subscribeEventMessage, unsubscribeEventMessage, wsReadyDefer } from "./websocket";
export function watch(eventType) {
    var _this = this;
    if (eventType === void 0) { eventType = "all"; }
    var others = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        others[_i - 1] = arguments[_i];
    }
    var events = Array.from(new Set((Array.isArray(eventType) ? eventType : [eventType]).concat(others)));
    if (!events.every(function (e) { return allEvents.includes(e) || e === "all"; })) {
        throw new Error(MESSAGE.RTC.BAD_EVENT_SUBSCRIPTION_TYPE);
    }
    return Observable.create(function (observer) {
        wsReadyDefer.promise.then(function () {
            subscribeEventMessage(_this.webSocket, events, _this.name, _this.resourceType, observer)
                .catch(function (error) { return observer.error(error); });
        });
        return function () { return wsReadyDefer.promise
            .then(function () { return unsubscribeEventMessage(_this.webSocket, events, _this.name, _this.resourceType, observer); }); };
    });
}
